<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-icons/av-icons.html">
<link rel="import" href="bower_components/iron-iconset/iron-iconset.html">
<link rel="import" href="bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="bower_components/iron-list/iron-list.html">
<link rel="import" href="bower_components/google-youtube/google-youtube.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-material/paper-material.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="bower_components/paper-item/paper-item-body.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">

<dom-module id="yt-player">
  <style is="custom-style">
    .horizontal-section {
      min-width: 200px;
    }

    paper-fab {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    paper-fab.blue {
      --paper-fab-background: var(--paper-light-blue-500);
      --paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
    }

    paper-fab.red {
      --paper-fab-background: var(--paper-red-500);
      --paper-fab-keyboard-focus-background: var(--paper-red-900);
    }

    paper-fab.green {
      --paper-fab-background: var(--paper-green-500);
      --paper-fab-keyboard-focus-background: var(--paper-green-900);
    }

    paper-fab.orange {
      --paper-fab-background: var(--paper-orange-500);
      --paper-fab-keyboard-focus-background: var(--paper-orange-900);
    }

    #player-wrapp {
      background-color: #fff
    }
  </style>
  <template>
    <paper-material elevation="1" style="width:100%;">
        <template is="dom-repeat" id="menu" items="{{musics}}">
          <paper-item yt-id$="{{item.id}}" on-click="listclick">
            <div class="musi-thumb">
              <iron-image style="width:60px; height:60px;" sizing="cover" src$="http://i.ytimg.com/vi/{{item.id}}/default.jpg"></iron-image>
              <!-- <iron-icon icon="warning"></iron-icon> -->
            </div>
            <paper-item-body two-line>
              <div>{{item.name}}</div>
              <div secondary>Your status is visible to everyone</div>
            </paper-item-body>
            <div>3:42</div>
          </paper-item>
        </template>
      <!-- yeah -->
      <paper-item yt-id="Kd7-baNMIF8" on-click="listclick">
        <div class="musi-thumb">
          <img src="http://i.ytimg.com/vi/Kd7-baNMIF8/default.jpg" alt="" />
          <!-- <iron-icon icon="warning"></iron-icon> -->
        </div>
        <paper-item-body two-line>
          <div>Show your status</div>
          <div secondary>Your status is visible to everyone</div>
        </paper-item-body>
        <div> 3: 24</div>
      </paper-item>
    </paper-material>

    <div id="player-wrapp">
      <google-youtube id="googleYouTube"
                      width="90px"
                      height="50px"
                      playsupported="{{playSupported}}"
                      video-id="F5bIdqZHEOo"
                      state="{{state}}"
                      currenttime="{{currentTime}}"
                      currenttimeformatted="{{currentTimeFormatted}}"
                      duration="{{duration}}"
                      durationformatted="{{durationFormatted}}"
                      fractionloaded="{{fractionLoaded}}"
                      on-google-youtube-state-change="handleStateChange"
                      on-google-youtube-error="handleYouTubeError"
                      chromeless = true>
      </google-youtube>
      <paper-slider value="{{computeProgress(currentTime, duration)}}" role="slider" tabindex="0" aria-disabled="false" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" step="0.01" class="x-scope paper-slider-0"></paper-slider>
      <div id="player-inner">
        <paper-fab mini icon="av:play-arrow" class="orange" id="playerPlayCtl" on-click="togglePlay"></paper-fab>
      </div>
    </div>
  </template>

  <script type="text/javascript">
    window.addEventListener('WebComponentsReady', function(e) {


      var yt_player, play_ctl_btn;
      play_ctl_btn = document.querySelector('#player-play-ctl');
      yt_player = document.querySelector('google-youtube');


      Polymer({
        is: "yt-player",
        properties: {
          playSupported: String,
          state: String,
          currentTime: Number,
          currentTimeFormatted: String,
          duration: Number,
          durationFormatted: String,
          fractionLoaded: Number,
          events: {
            type: Array,
            value: []
          },
          cartoon: {
            type: Array
          }
        },
        ready: function() {
          this.musics = [
              { name: "Every Little Thing / 「ANATA TO」MUSIC VIDEO＋SPOT映像", id: "HQkpn0o39Vc" },
              { name: "Pasta", ordered: 0 },
              { name: "Toast", ordered: 0 }
          ];
          console.log(this.musics)
        },
        computeProgress: function(currentTime, duration) {
          return currentTime / duration * 100;
        },
        computePlayDisabled: function(state, playSupported) {
          return state == 1 || state == 3 || !playSupported;
        },
        computePauseDisabled: function(state) {
          return state != 1 && state != 3;
        },
        handleStateChange: function(ev) {
          this.events.push({data: ev.detail.data});

          if (ev.detail.data == 1 ){
            console.log(this.$.playerPlayCtl.icon)
            this.$.playerPlayCtl.icon = 'av:pause';
          }else{
            this.$.playerPlayCtl.icon = 'av:play-arrow'
          }
        },
        handleYouTubeError: function(ev) {
          console.error('YouTube playback error', ev.detail);
        },
        handlePlayVideo: function(ev) {
          this.$.googleYouTube.play();
          this.$.playerPlayCtl.icon = 'av:pause';
        },
        handlePauseVideo: function(ev) {
          this.$.googleYouTube.pause();
          this.$.playerPlayCtl.icon = 'av:play-arrow';
        },
        handleCueVideo: function(ev) {
          this.$.googleYouTube.videoid = this.$.videoId.value;
        },
        togglePlay: function(ev) {
          if (this.$.googleYouTube.state == 1 ){
            this.$.googleYouTube.pause();
            this.$.playerPlayCtl.icon = 'av:play-arrow'
          }else{
            this.$.googleYouTube.play();
            this.$.playerPlayCtl.icon = 'av:pause';
          }
        },
        listclick: function(ytid) {
          console.log(ytid)
          this.$.googleYouTube.videoId = ytid.toElement.parentNode.getAttributeNode("yt-id").value;
          this.$.googleYouTube.play()
        }
      });

      document.querySelector('#player-wrapp').addEventListener('mouseover', function(){ document.querySelector('paper-slider').$.sliderKnob.hidden = false });
      document.querySelector('#player-wrapp').addEventListener('mouseout', function(){ document.querySelector('paper-slider').$.sliderKnob.hidden = true });
      document.querySelector('paper-slider').$.sliderKnob.hidden = true;

    });
  </script>
</dom-module>
